<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Tarefas V2</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
    
    <style>
        /* CSS */

        /* Pela TAG HTML */
        body {
            background-color: cornsilk;
            font-family: 'Dancing Script'
        }
        h1 {
            color:orange;
        }
        h2 {
            border-bottom: 3px dotted darkgoldenrod;
        }
        /* Pela class HTML */
        .concluida {
          text-decoration: line-through;
          color: green;
        }
        li {
            height: 30px;
        }
        .excluir {
            background-color: red;
            border: none;
            border-radius: 4px;
            color: white;            
        }
        
    </style>

    <script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>
    <script>
        // Código JavaScript

        class Tarefa {
            constructor(titulo) {
                this.titulo = titulo;
                this.concluida = false;
            }
        }

        var tarefas = [
            
        ];

        function adicionarTarefa() {
            let inputTitulo = document.getElementById('titulo');
            
            // Dois sinais de igual == compara o conteúdo
            // 5 == '5' -> TRUE
            // Três sinais de igual === compara o tipo e o conteúdo
            // 5 === '5' -> FALSE
            // 3 sinais de igual
            if (inputTitulo.value.trim().length === 0) {
                alert('Informe o nome da tarefa');
                return;
            }

            $.post({
                url: 'http://localhost:3000/tarefas',
                data: JSON.stringify({
                    titulo: inputTitulo.value
                }),
                dataType: 'json',
                contentType: 'application/json',
                success: function(data) {
                    atualizarListaDeTarefas();
                }
            });

            inputTitulo.value = '';
            inputTitulo.focus();
        }

        function salvarTarefas() {
            let tarefasString = JSON.stringify(tarefas);
            localStorage.setItem('tarefas', tarefasString);
        }

        function verificarEnter(event) {
            if (event.keyCode == 13) {
                adicionarTarefa();
            }
        }

        function concluir(indiceTarefa) {
            console.log('Concluir tarefa ', indiceTarefa);
            tarefas[indiceTarefa].concluida = !tarefas[indiceTarefa].concluida;
            salvarTarefas();
            atualizarListaDeTarefas();
        }

        function excluir(indiceTarefa) {
            console.log('Excluir tarefa ', indiceTarefa);
            tarefas.splice(indiceTarefa, 1);
            salvarTarefas();
            atualizarListaDeTarefas();
        }

        function atualizarListaDeTarefas() {
            console.log('Atualizando a lista das tarefas');

            $.get( "http://localhost:3000/tarefas", function( data ) {

                const tarefas = data;

                let lista = document.getElementById('lista-tarefas');
            
                let conteudo = '';
                for(let i = 0; i < tarefas.length; i++){

                    let classConcluida;
                    let checked;
                    if(tarefas[i].concluida == true) {
                        classConcluida = 'class="concluida"';
                        checked = 'checked';
                    } else {
                        classConcluida = '';
                        checked = '';
                    }

                    let item = '';
                    item += '<li ' + classConcluida + '>';
                    item += '<input ' + checked + ' type="checkbox" onclick="concluir(' + i + ')">';
                    item += tarefas[i].titulo;
                    item += '<input type="button" value="X" class="excluir" onclick="excluir(' + i + ')">';
                    item += '</li>';                
                    conteudo += item;
                }

                lista.innerHTML = conteudo;
                document.getElementById('contadores').innerHTML = `Voce tem ${tarefas.length} tarefas`;
            });
        }

        window.onload = () => {
            atualizarListaDeTarefas();
        }
    </script>

</head>
<body>
    <h1>Lista de Tarefas</h1>

    <h2>Adicionar nova tarefa</h2>
    <span>Título da nova tarefa</span>
    <input type="text" id="titulo" onkeypress="verificarEnter(event)">
    <input type="button" value="Adicionar" 
        onclick="adicionarTarefa()">
    
    <h2>Lista das minhas tarefas</h2>
    <h3 id="contadores"></h3>
    <ul id="lista-tarefas">
        
    </ul>
</body>
</html>